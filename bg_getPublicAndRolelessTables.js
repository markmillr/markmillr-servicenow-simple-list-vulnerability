(function() {
    var output = '\n'; // First line should be empty to make copy/paste easier

    // Function to print sample table names for spot checking
    function printSampleTableNames(title, tableNameList) {
        var sampleSize = 5; // Number of samples to show
        var samples = tableNameList.slice(0, sampleSize).join(', ');
        gs.info(title + ' (showing up to ' + sampleSize + ' tables): ' + samples);
    }

    // Function to simulate Set behavior
    function UniqueList() {
        this.items = {};
        this.add = function(item) {
            this.items[item] = true;
        };
        this.toArray = function() {
            return Object.keys(this.items);
        };
    }

    // Function to get table names with 'public' role ACLs
    function getTablesWithPublicRole() {
        var tableNameSet = new UniqueList();
        var gr = new GlideRecord('sys_security_acl_role');
        gr.addEncodedQuery('sys_security_acl!=NULL^sys_user_role=b0593b350a0a0aa7001d689e4542dc28^sys_security_acl.nameNOT LIKE.^sys_security_acl.nameNOT LIKE*^sys_security_acl.nameLIKE_');
        gr.query();

        while (gr.next()) {
            tableNameSet.add(gr.sys_security_acl.name.toString());
        }
        var tableNameList = tableNameSet.toArray();
        gs.info('Tables with Public Role: ' + tableNameList.length);
        printSampleTableNames('Sample Tables with Public Role', tableNameList);
        return tableNameList;
    }

    // Function to get table names with no roles
    function getTablesWithNoRoles() {
        var tableNameSet = new UniqueList();
        var aclGr = new GlideRecord('sys_security_acl');
        aclGr.addEncodedQuery('nameNOT LIKE.^nameNOT LIKE*^nameLIKE_');
        aclGr.query();

        while (aclGr.next()) {
            var roleGr = new GlideRecord('sys_security_acl_role');
            roleGr.addQuery('sys_security_acl', '=', aclGr.sys_id.toString());
            roleGr.query();

            if (!roleGr.hasNext()) {
                tableNameSet.add(aclGr.name.toString());
            }
        }
        var tableNameList = tableNameSet.toArray();
        gs.info('Tables with No Roles: ' + tableNameList.length);
        printSampleTableNames('Sample Tables with No Roles', tableNameList);
        return tableNameList;
    }

    // Get tables with 'public' role ACLs
    var tablesWithPublicRole = getTablesWithPublicRole();

    // Get tables with no roles
    var tablesWithNoRoles = getTablesWithNoRoles();

    // Merge the two lists and remove duplicates
    var totalUniqueTableSet = new UniqueList();
    tablesWithPublicRole.forEach(function(table) {
        totalUniqueTableSet.add(table);
    });
    tablesWithNoRoles.forEach(function(table) {
        totalUniqueTableSet.add(table);
    });

    var uniqueTables = totalUniqueTableSet.toArray();

    // Add table names to output
    output += 'Total Unique Tables: ' + uniqueTables.length + '\n';
    output += uniqueTables.join('\n');

    // Log output
    gs.info(output);
})();